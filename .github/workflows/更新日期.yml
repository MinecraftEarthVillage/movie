name: è‡ªåŠ¨æ›´æ–°æ—¥æœŸ

on:
  push:
    branches:
      - main          # æŒ‰éœ€æ”¹ä¸ºä½ çš„é»˜è®¤åˆ†æ”¯å
    paths:
      - 'data/video-data.json'          # ä»…å½“æ­¤æ–‡ä»¶å˜æ›´æ—¶è§¦å‘
      - 'scripts/update-video-dates.js' # æˆ–è„šæœ¬è‡ªèº«æ›´æ–°æ—¶è§¦å‘

jobs:
  update-dates:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # å…è®¸æ¨é€æäº¤
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # æ‹‰å–å®Œæ•´å†å²ï¼Œç”¨äº git log

      - name: å¯åŠ¨ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Run date update script
        run: node scripts/update-video-dates.js

      - name: å¦‚æœæ”¹å˜äº†å°±æäº¤æ¨é€
        run: |
          git config --global ä¹ˆä¹ˆå“’æœºå™¨äºº 'github-actions[bot]'
          git config --global null@null.null 'github-actions[bot]@users.noreply.github.com'
          git add data/video-data.json
          if git diff --staged --quiet; then
            echo "â„¹ï¸ æ²¡æœ‰ä»€ä¹ˆæ”¹å˜çš„"
          else
            git commit -m "chore(data): è¡¥é½äº†æ‰€æœ‰ç¼ºå¤±çš„è§†é¢‘å‘å¸ƒæ—¥æœŸ ğŸ“… [skip ci]"
            git push
          fi